# test existence of built in modules
function test.require.exists? {
	local modules=( variable string method color console array require fs );
	local module;
	for module in ${modules[@]}
		do
			require.exists? "$module";
			assert.eq "0" "$?";
			require.name.exists? "$module";
			assert.eq "0" "$?";
			require.path.exists? "${library_dirs[modules]}/$module";
			assert.eq "0" "$?";
	done
}

# test for absolute require
function test.require.absolute {
	dir="$_result";
	require "${testdir}/modules/say";
	assert.eq "0" "$?";
	assert.on.loaded.module;
}

# test for module search path lookup
function test.require.lookup {
	require "string";
	assert.eq "0" "$?";
	local methods=( $( method.list | egrep '^string' ) );
	assert.gt "1" "${#methods[@]}";
}

# test for relative require using: ./
function test.require.relative {
	require "./modules/say";
	assert.eq "0" "$?";
	assert.on.loaded.module;
}

# test for relative require using: ../
function test.require.relative.parent {
	require "../test/modules/say";
	assert.eq "0" "$?";
	assert.on.loaded.module;
}

# test for a non-existent module
function test.require.nonexistent {
	require "nonexistent" &
	wait %%;
	assert.eq "1" "$?";
}

function assert.on.loaded.module {
	local methods=( $( method.list | grep "say" ) );
	methods="${methods[@]}";
	assert.equal "say say.goodbye say.hello" "${methods}";

	# clean up declared methods
	method.remove "say";
	method.remove "say.goodbye";
	method.remove "say.hello";
}