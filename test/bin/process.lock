#!/usr/bin/env bash

. ~/.strike/boilerplate.sh;
boilerplate "$@";

process.use 'strict';
require.once 'assert';

# let assert(3) know if this test
# is being run standalone or as
# part of a task-test(7) test suite
assert.parse "$@";

function lockfile {
	# switch on lock file usage - singleton process
	process.lock.use!;
	# assert that we have a lock file
	process.lock.file;
	assert.file.exists? "$_result";
	process.lock?;
	assert.eq "0" "$?";
	
	# switch off lock file usage
	process.lock.use! off;
	# assert that the lock file does not exist
	process.lock.file;
	assert.file.exists! "$_result";
	
	assert.summary;
}
lockfile "$@";
exit 0;