#!/usr/bin/env bash

######################################################################
#
#	BOILERPLATE
#
######################################################################
console_print_program_prefix="off";
declare -gx exedir;
function boilerplate {
	local abspath=$(cd ${BASH_SOURCE[0]%/*} && echo $PWD/${0##*/});
	if [ -L "$abspath" ]; then abspath=`readlink $abspath`; fi
	if [[ "$abspath" =~ ^\./ ]]; then abspath="${PWD}/${abspath}"; fi
	exedir=`dirname "$abspath"`;
	local libdir="$exedir/../../lib";
	source "$libdir/shared" "$@";
}
boilerplate "$@";
######################################################################

process.use 'strict';
require 'assert';

function lockfile {
	# switch on lock file usage - singleton process
	process.lock.use!;
	# assert that we have a lock file
	process.lock.file;
	assert.file.exists? "$_result";
	process.lock?;
	assert.eq "0" "$?";
	
	# switch off lock file usage
	process.lock.use! off;
	# assert that the lock file does not exist
	process.lock.file;
	assert.file.exists! "$_result";
}
lockfile "$@";
exit 0;