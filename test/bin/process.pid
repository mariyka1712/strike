#!/usr/bin/env bash

######################################################################
#
#	BOILERPLATE
#
######################################################################
console_print_program_prefix="off";
declare -gx exedir;
function boilerplate {
	local src="${BASH_SOURCE[0]}"
	exedir="$( dirname "$src" )"
	while [ -h "$src" ]
		do 
			src="$(readlink "$src")";
			[[ $src != /* ]] && src="$exedir/$src";
			exedir="$( cd -P "$( dirname "$src"  )" && pwd )";
	done
	exedir="$( cd -P "$( dirname "$src" )" && pwd )";
	unset src;
	source "$exedir/../../lib/shared" "$@";
}
boilerplate "$@";
######################################################################

process.use 'strict';
require 'assert';

function pidfile {
	# switch on pid file usage
	# must be done after the signal assertions!
	process.pid.use!;
	# assert that we have a pid file
	process.pid.file;
	assert.file.exists? "$_result";
	process.pid?;
	assert.eq "0" "$?";
	
	# switch off pid file usage
	process.pid.use! off;
	# assert that the pid file does not exist
	process.pid.file;
	assert.file.exists! "$_result";
}

pidfile "$@";
exit 0;