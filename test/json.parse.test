require.once 'json';

function test.json.parse.array {
	local k v;
	json.parse <<< '[ "value", "another value", "some other value" ]';
	# assert.equal "0 1 2" "${!json_doc[*]}";
	# assert.equal "value" "${json_doc[0]}";
	# assert.equal "another value" "${json_doc[1]}";
	# assert.equal "some other value" "${json_doc[2]}";
	!test.json.parse.print;
}

function test.json.parse.array.multi {
	local k v;
	json.parse <<< '[ "a", [ "b", "c", "d" ], "e" ]';
	# assert.equal "0 1 2" "${!json_doc[*]}";
	# assert.equal "value" "${json_doc[0]}";
	# assert.equal "another value" "${json_doc[1]}";
	# assert.equal "some other value" "${json_doc[2]}";
	!test.json.parse.print;
}

function !test.json.parse.print {
	local k v;
	echo "test got keys: ${!json_doc[@]}";
	for k in "${!json_doc[@]}"
		do
			v="${json_doc[$k]}";
			console.log "$k=$v";
	done
}