#!/usr/bin/env bash
# #!/bin/bash.3.2.48

: <<'ronn:markdown'
strike(1) -- require for bash
=============================================

## SYNOPSIS

Modular `bash` using `require`.

## DESCRIPTION

Brings structure and modularity to `bash` programs and provides a set of modules that can be used from any `bash` program.

## MODULES

Once the library code has been included the following modules are automatically available to your code.

### method

The method(1) module provides utility functions for determining whether functions exist, listing functions and removing methods.

## FILES

...

## ENVIRONMENT

...

## BUGS

**strike** is written in bash and depends upon `bash` >= 4 for associative arrays.

## COPYRIGHT

**strike** is copyright (c) 2012 muji <http://xpm.io>

## SEE ALSO

boilerplate(3), method(1), http(7), bake(1), rest(1)
ronn:markdown

set -o errtrace;
set -o errexit;
set -o nounset;

######################################################################
#
#	BOILERPLATE
#
######################################################################
export PROGRAM_NAME=`basename $0`;
program_config_print_prefix="off";
declare -gx exedir;
function boilerplate {
	local abspath=$(cd ${BASH_SOURCE[0]%/*} && echo $PWD/${0##*/});
	if [ -L "$abspath" ]; then
		abspath=`readlink $abspath`;
	fi
	exedir=`dirname "$abspath"`;
	local libdir="$exedir/../lib";
	source "$libdir/shared";
}
boilerplate;
######################################################################

# set up the main delegate module as 'strike'
module="$PROGRAM_NAME";

# configure help
require 'help';
help.man.page "default" "strike.1";
help.parse "$@";

function strike.info {
	system print;
}

# configure options
require 'options';

options_minimum=1;
options_fail_help=1;
options_expects_command=( info );
options_map_command_method=1;
#configure all the option defaults
options configure;
#parse the parameters
options parse "$@";

delegate "${module:-}" "${options_command_method:-}" "${module_options[@]:-}";
exit 0;